# IW03: Настройка планировщика задач (cron)

## Цель

Научиться настраивать планировщик задач (cron) для автоматизации выполнения скриптов.

## Подготовка

Задание основано на лабораторной работе №2. Скопируйте файлы из лабораторной работы №2 в новую директорию `lab03` для дальнейшей работы.

## Задание

В проекте `automation` создайте ветку `lab03`. Создайте директорию `lab03` и скопируйте туда файлы из лабораторной работы №2 (папка `lab02`).

В директории `lab03` создайте файл `cronjob`. В данном файле пропишите задачи cron, которые будут запускать скрипт `currency_exchange_rate.py`:

1. Ежедневно в 6:00 утра для получения курса MDL к EUR за предыдущий день.
2. Еженедельно в пятницу в 17:00 для получения курса MDL к USD за предыдущую неделю.

Создайте файл `Dockerfile` в директории `lab03`, на основе Ubuntu или официального Python образа, который будет:

1. Устанавливать необходимые зависимости для запуска скрипта (cron, Python и необходимые библиотеки).
2. Копировать скрипт `currency_exchange_rate.py`, файл `cronjob` и entrypoint скрипт в контейнер.
3. Настраивать cron для выполнения задач, указанных в файле `cronjob`.
4. Запускать cron в фоновом режиме при старте контейнера.
5. Записывать вывод cron задач в файл `/var/log/cron.log`.

Для упрощения работы с cron рекомендуется использовать entrypoint-скрипт, который будет настраивать и запускать cron. Пример такого скрипта приведен ниже:

```bash
#!/bin/sh

create_log_file() {
    echo "Creating log file..."
    touch /var/log/cron.log
    chmod 666 /var/log/cron.log
    echo "Log file created at /var/log/cron.log"
}

monitor_logs() {
    echo "=== Monitoring cron logs ==="
    tail -f /var/log/cron.log
}

run_cron() {
    echo "=== Starting cron daemon ==="
    exec cron -f
}

env > /etc/environment
create_log_file
monitor_logs &
run_cron
```

Создайте файл `docker-compose.yml` в директории `lab03`, который будет использовать созданный Dockerfile для сборки образа и запуска контейнера.

Создайте файл `readme.md` в директории `lab03`, в котором опишите:

1. Как собрать и запустить контейнер с cron.
2. Как проверить, что cron задачи выполняются и вывод записывается в файл `/var/log/cron.log`.
3. Описание структуры проекта и назначения каждого файла.

## Представление

Загрузите скрипт в репозиторий GitHub и предоставьте ссылку на него.

## Оценивание

| Критерий                                  | Нет | Частично | Да   |
| ----------------------------------------- | --- | -------- | ---- |
| Выполнение требований                     | 0   | 50       | 100  |
| Код хорошо структурирован и комментирован | 0   | 20       | 40   |
| Обработка ошибок                          | 0   | 10       | 20   |
| Журналирование и уведомления              | 0   | 10       | 20   |
| Документация и примеры использования      | 0   | 10       | 20   |
| Каждый день опоздания                     | 0   | 0        | -20  |
| Плагиат                                   | 0   | 0        | -100 |
| **Итого**                                 |     |          | 200  |
